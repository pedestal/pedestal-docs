<!DOCTYPE html PUBLIC ""
    "">
<html><head><meta charset="UTF-8" /><title>io.pedestal.interceptor.chain documentation</title><link rel="stylesheet" type="text/css" href="css/default.css" /><link rel="stylesheet" type="text/css" href="css/highlight.css" /><script type="text/javascript" src="js/highlight.min.js"></script><script type="text/javascript" src="js/jquery.min.js"></script><script type="text/javascript" src="js/page_effects.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html"><span class="project-title"><span class="project-name">io.pedestal libraries</span> <span class="project-version">0.7.0-beta-3</span></span></a></h1></div><div class="sidebar primary"><h3 class="no-link"><span class="inner">Project</span></h3><ul class="index-link"><li class="depth-1 "><a href="index.html"><div class="inner">Index</div></a></li></ul><h3 class="no-link"><span class="inner">Namespaces</span></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>io</span></div></div></li><li class="depth-2"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>pedestal</span></div></div></li><li class="depth-3 branch"><a href="io.pedestal.environment.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>environment</span></div></a></li><li class="depth-3"><a href="io.pedestal.http.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>http</span></div></a></li><li class="depth-4 branch"><a href="io.pedestal.http.body-params.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>body-params</span></div></a></li><li class="depth-4 branch"><a href="io.pedestal.http.container.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>container</span></div></a></li><li class="depth-4 branch"><a href="io.pedestal.http.content-negotiation.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>content-negotiation</span></div></a></li><li class="depth-4 branch"><a href="io.pedestal.http.cors.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>cors</span></div></a></li><li class="depth-4 branch"><a href="io.pedestal.http.csrf.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>csrf</span></div></a></li><li class="depth-4"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>impl</span></div></div></li><li class="depth-5"><a href="io.pedestal.http.impl.servlet-interceptor.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>servlet-interceptor</span></div></a></li><li class="depth-6"><a href="io.pedestal.http.impl.servlet-interceptor.specs.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>specs</span></div></a></li><li class="depth-4"><a href="io.pedestal.http.jetty.html"><div class="inner"><span class="tree" style="top: -83px;"><span class="top" style="height: 92px;"></span><span class="bottom"></span></span><span>jetty</span></div></a></li><li class="depth-5 branch"><a href="io.pedestal.http.jetty.container.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>container</span></div></a></li><li class="depth-5"><a href="io.pedestal.http.jetty.util.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>util</span></div></a></li><li class="depth-4 branch"><a href="io.pedestal.http.params.html"><div class="inner"><span class="tree" style="top: -83px;"><span class="top" style="height: 92px;"></span><span class="bottom"></span></span><span>params</span></div></a></li><li class="depth-4"><a href="io.pedestal.http.request.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>request</span></div></a></li><li class="depth-5 branch"><a href="io.pedestal.http.request.lazy.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>lazy</span></div></a></li><li class="depth-5 branch"><a href="io.pedestal.http.request.map.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>map</span></div></a></li><li class="depth-5 branch"><a href="io.pedestal.http.request.servlet-support.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>servlet-support</span></div></a></li><li class="depth-5"><a href="io.pedestal.http.request.zerocopy.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>zerocopy</span></div></a></li><li class="depth-4 branch"><a href="io.pedestal.http.ring-middlewares.html"><div class="inner"><span class="tree" style="top: -145px;"><span class="top" style="height: 154px;"></span><span class="bottom"></span></span><span>ring-middlewares</span></div></a></li><li class="depth-4"><a href="io.pedestal.http.route.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>route</span></div></a></li><li class="depth-5"><a href="io.pedestal.http.route.definition.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>definition</span></div></a></li><li class="depth-6 branch"><a href="io.pedestal.http.route.definition.table.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>table</span></div></a></li><li class="depth-6 branch"><a href="io.pedestal.http.route.definition.terse.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>terse</span></div></a></li><li class="depth-6"><a href="io.pedestal.http.route.definition.verbose.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>verbose</span></div></a></li><li class="depth-5 branch"><a href="io.pedestal.http.route.linear-search.html"><div class="inner"><span class="tree" style="top: -114px;"><span class="top" style="height: 123px;"></span><span class="bottom"></span></span><span>linear-search</span></div></a></li><li class="depth-5 branch"><a href="io.pedestal.http.route.map-tree.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>map-tree</span></div></a></li><li class="depth-5 branch"><a href="io.pedestal.http.route.path.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>path</span></div></a></li><li class="depth-5 branch"><a href="io.pedestal.http.route.prefix-tree.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>prefix-tree</span></div></a></li><li class="depth-5 branch"><a href="io.pedestal.http.route.router.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>router</span></div></a></li><li class="depth-5"><a href="io.pedestal.http.route.specs.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>specs</span></div></a></li><li class="depth-4 branch"><a href="io.pedestal.http.secure-headers.html"><div class="inner"><span class="tree" style="top: -331px;"><span class="top" style="height: 340px;"></span><span class="bottom"></span></span><span>secure-headers</span></div></a></li><li class="depth-4 branch"><a href="io.pedestal.http.servlet.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>servlet</span></div></a></li><li class="depth-4 branch"><a href="io.pedestal.http.specs.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>specs</span></div></a></li><li class="depth-4 branch"><a href="io.pedestal.http.sse.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>sse</span></div></a></li><li class="depth-4"><a href="io.pedestal.http.tracing.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>tracing</span></div></a></li><li class="depth-3"><a href="io.pedestal.interceptor.html"><div class="inner"><span class="tree" style="top: -1075px;"><span class="top" style="height: 1084px;"></span><span class="bottom"></span></span><span>interceptor</span></div></a></li><li class="depth-4 current"><a href="io.pedestal.interceptor.chain.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>chain</span></div></a></li><li class="depth-5"><a href="io.pedestal.interceptor.chain.debug.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>debug</span></div></a></li><li class="depth-4 branch"><a href="io.pedestal.interceptor.error.html"><div class="inner"><span class="tree" style="top: -52px;"><span class="top" style="height: 61px;"></span><span class="bottom"></span></span><span>error</span></div></a></li><li class="depth-4 branch"><a href="io.pedestal.interceptor.helpers.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>helpers</span></div></a></li><li class="depth-4 branch"><a href="io.pedestal.interceptor.specs.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>specs</span></div></a></li><li class="depth-4"><a href="io.pedestal.interceptor.trace.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>trace</span></div></a></li><li class="depth-3 branch"><a href="io.pedestal.log.html"><div class="inner"><span class="tree" style="top: -207px;"><span class="top" style="height: 216px;"></span><span class="bottom"></span></span><span>log</span></div></a></li><li class="depth-3"><a href="io.pedestal.metrics.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>metrics</span></div></a></li><li class="depth-4 branch"><a href="io.pedestal.metrics.codahale.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>codahale</span></div></a></li><li class="depth-4 branch"><a href="io.pedestal.metrics.otel.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>otel</span></div></a></li><li class="depth-4"><a href="io.pedestal.metrics.spi.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>spi</span></div></a></li><li class="depth-3"><div class="no-link"><div class="inner"><span class="tree" style="top: -114px;"><span class="top" style="height: 123px;"></span><span class="bottom"></span></span><span>service-tools</span></div></div></li><li class="depth-4 branch"><a href="io.pedestal.service-tools.dev.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>dev</span></div></a></li><li class="depth-4"><a href="io.pedestal.service-tools.war.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>war</span></div></a></li><li class="depth-3"><div class="no-link"><div class="inner"><span class="tree" style="top: -83px;"><span class="top" style="height: 92px;"></span><span class="bottom"></span></span><span>telemetry</span></div></div></li><li class="depth-4"><a href="io.pedestal.telemetry.otel-global-init.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>otel-global-init</span></div></a></li><li class="depth-3 branch"><a href="io.pedestal.test.html"><div class="inner"><span class="tree" style="top: -52px;"><span class="top" style="height: 61px;"></span><span class="bottom"></span></span><span>test</span></div></a></li><li class="depth-3"><a href="io.pedestal.tracing.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>tracing</span></div></a></li><li class="depth-4"><a href="io.pedestal.tracing.spi.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>spi</span></div></a></li><li class="depth-3"><a href="io.pedestal.websocket.html"><div class="inner"><span class="tree" style="top: -52px;"><span class="top" style="height: 61px;"></span><span class="bottom"></span></span><span>websocket</span></div></a></li><li class="depth-4"><a href="io.pedestal.websocket.specs.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>specs</span></div></a></li></ul></div><div class="sidebar secondary"><h3><a href="#top"><span class="inner">Public Vars</span></a></h3><ul><li class="depth-1"><a href="io.pedestal.interceptor.chain.html#var-add-observer"><div class="inner"><span>add-observer</span></div></a></li><li class="depth-1"><a href="io.pedestal.interceptor.chain.html#var-bind"><div class="inner"><span>bind</span></div></a></li><li class="depth-1"><a href="io.pedestal.interceptor.chain.html#var-enqueue"><div class="inner"><span>enqueue</span></div></a></li><li class="depth-1"><a href="io.pedestal.interceptor.chain.html#var-enqueue*"><div class="inner"><span>enqueue*</span></div></a></li><li class="depth-1"><a href="io.pedestal.interceptor.chain.html#var-execute"><div class="inner"><span>execute</span></div></a></li><li class="depth-1"><a href="io.pedestal.interceptor.chain.html#var-execute-only"><div class="inner"><span>execute-only</span></div></a></li><li class="depth-1"><a href="io.pedestal.interceptor.chain.html#var-on-enter-async"><div class="inner"><span>on-enter-async</span></div></a></li><li class="depth-1"><a href="io.pedestal.interceptor.chain.html#var-queue"><div class="inner"><span>queue</span></div></a></li><li class="depth-1"><a href="io.pedestal.interceptor.chain.html#var-terminate"><div class="inner"><span>terminate</span></div></a></li><li class="depth-1"><a href="io.pedestal.interceptor.chain.html#var-terminate-when"><div class="inner"><span>terminate-when</span></div></a></li><li class="depth-1"><a href="io.pedestal.interceptor.chain.html#var-unbind"><div class="inner"><span>unbind</span></div></a></li></ul></div><div class="namespace-docs" id="content"><h1 class="anchor" id="top">io.pedestal.interceptor.chain</h1><div class="doc"><div class="markdown"><p>Interceptor pattern. Executes a chain of Interceptor functions on a common “context” map, maintaining a virtual “stack”, with error handling and support for asynchronous execution.</p>
</div></div><div class="public anchor" id="var-add-observer"><h3>add-observer</h3><h4 class="added">added in 0.7.0</h4><div class="usage"><code>(add-observer context observer-fn)</code></div><div class="doc"><div class="markdown"><p>Adds an observer function to the execution; observer functions are notified after each interceptor executes.  If the interceptor is asynchronous, the notification occurs once the new context is conveyed through the returned channel.</p>
<p>The function is passed an event map:</p>
<table>
<thead>
<tr><th>Key               </th><th> Type              </th><th> Description</th></tr>
</thead>
<tbody>
<tr><td>:execution-id     </td><td> integer           </td><td> Unique per-process id for the execution</td></tr>
<tr><td>:stage            </td><td> :enter, :leave, or :error</td></tr>
<tr><td>:interceptor-name </td><td> keyword or string </td><td> The interceptor that was invoked (either its :name or a string)</td></tr>
<tr><td>:context-in       </td><td> map               </td><td> The context passed to the interceptor</td></tr>
<tr><td>:context-out      </td><td> map               </td><td> The context returned from the interceptor</td></tr>
</tbody>
</table>
<p>The observer is only invoked for interceptor <em>executions</em>; when an interceptor does not provide a callback for a stage, the interceptor is not invoked, and so the observer is not invoked.</p>
<p>The value returned by the observer is ignored.</p>
<p>If an observer throws an exception, it is associated with the interceptor, exactly as if the interceptor had thrown the exception.</p>
<p>When multiple observer functions are added, they are invoked in an unspecified order.</p>
<p>The <a href="io.pedestal.interceptor.chain.debug.html#var-debug-observer">debug-observer</a> function is used to create an observer function; this observer can be used to log each interceptor that executes, in what phase it executes, and how it modifies the context map..</p>
</div></div><div class="src-link"><a href="https://github.com/pedestal/pedestal/blob/0.7.0-beta-3/interceptor/src/io/pedestal/interceptor/chain.clj#L486">view source</a></div></div><div class="public anchor" id="var-bind"><h3>bind</h3><h4 class="type">macro</h4><h4 class="added">added in 0.7.0</h4><div class="usage"><code>(bind context var value)</code></div><div class="doc"><div class="markdown"><p>Updates the context to add a binding of the given var and value. This is a convenience on modifying the :bindings key (a map of Vars and values).</p>
<p>Bound values will be available in subsequent interceptors.</p>
</div></div><div class="src-link"><a href="https://github.com/pedestal/pedestal/blob/0.7.0-beta-3/interceptor/src/io/pedestal/interceptor/chain.clj#L374">view source</a></div></div><div class="public anchor" id="var-enqueue"><h3>enqueue</h3><div class="usage"><code>(enqueue context interceptors)</code></div><div class="doc"><div class="markdown"><p>Adds interceptors to the end of context’s execution queue. Creates the queue if necessary. Returns updated context.</p>
</div></div><div class="src-link"><a href="https://github.com/pedestal/pedestal/blob/0.7.0-beta-3/interceptor/src/io/pedestal/interceptor/chain.clj#L309">view source</a></div></div><div class="public anchor" id="var-enqueue*"><h3>enqueue*</h3><div class="usage"><code>(enqueue* context &amp; interceptors-and-seq)</code></div><div class="doc"><div class="markdown"><p>Like <a href="io.pedestal.interceptor.chain.html#var-enqueue">enqueue</a> but accepting a variable number of arguments. If the last argument is itself a sequence of interceptors, they’re unpacked and added to the context’s execution queue.</p>
</div></div><div class="src-link"><a href="https://github.com/pedestal/pedestal/blob/0.7.0-beta-3/interceptor/src/io/pedestal/interceptor/chain.clj#L317">view source</a></div></div><div class="public anchor" id="var-execute"><h3>execute</h3><div class="usage"><code>(execute context)</code><code>(execute context interceptors)</code></div><div class="doc"><div class="markdown"><p>Executes a queue of <a href="null">Interceptor</a>s attached to the context. Context must be a map, Interceptors are added with ‘enqueue’.</p>
<p>An Interceptor is record with the keys :enter, :leave, and :error. The value of each key is a function; missing keys or nil values are ignored. When executing a context, first all the :enter functions are invoked in order. As this happens, the Interceptors are pushed on to a stack.  Interceptor may also have a :name, which is used when logging.</p>
<p>When execution reaches the end of the queue, it begins popping Interceptors off the stack and calling their :leave functions. Therefore :leave functions are called in the opposite order from :enter functions.</p>
<p>Both the :enter and :leave functions are passed a single argument, the context map, and return an updated context.</p>
<p>If any Interceptor function throws an exception, execution stops and begins popping Interceptors off the stack and calling their :error functions. The :error function takes two arguments: the context and an exception. It may either handle the exception, in which case the execution continues with the next :leave function on the stack; or re-throw the exception, passing control to the :error function on the stack. If the exception reaches the end of the stack without being handled, execute will throw it</p>
<p>Functions may return a core.async channel; this represents an asynchronous process.  When this happens, the initial call to execute returns nil immediately, with the process exepected to write an updated context into the channel when its work completes.</p>
<p>The function <a href="io.pedestal.interceptor.chain.html#var-on-enter-async">on-enter-async</a> is used to provide a callback for when an interceptor chain execution first switches from in-thread to asynchronous execution.</p>
<p>Processing continues in core.async threads - including even when a later interceptor returns an immediate context, rather than a channel.</p>
</div></div><div class="src-link"><a href="https://github.com/pedestal/pedestal/blob/0.7.0-beta-3/interceptor/src/io/pedestal/interceptor/chain.clj#L416">view source</a></div></div><div class="public anchor" id="var-execute-only"><h3>execute-only</h3><h4 class="deprecated">deprecated in 0.7.0</h4><div class="usage"><code>(execute-only context interceptor-key)</code><code>(execute-only context interceptor-key interceptors)</code></div><div class="doc"><div class="markdown"><p>Like <a href="io.pedestal.interceptor.chain.html#var-execute">execute</a>, but only processes the interceptors in a single direction, using <code>interceptor-key</code> (i.e. :enter, :leave) to determine which functions to call.</p>
<p>Executes a queue of Interceptors attached to the context. Context must be a map, Interceptors are added with ‘enqueue’.</p>
<p>An Interceptor Record has keys :enter, :leave, and :error. The value of each key is a function; missing keys or nil values are ignored. When executing a context, all the <code>interceptor-key</code> functions are invoked in order. As this happens, the Interceptors are pushed on to a stack.</p>
</div></div><div class="src-link"><a href="https://github.com/pedestal/pedestal/blob/0.7.0-beta-3/interceptor/src/io/pedestal/interceptor/chain.clj#L389">view source</a></div></div><div class="public anchor" id="var-on-enter-async"><h3>on-enter-async</h3><h4 class="added">added in 0.7.0</h4><div class="usage"><code>(on-enter-async context f)</code></div><div class="doc"><div class="markdown"><p>Adds a callback function to be executed if the execution goes async, which occurs when an interceptor returns a channel rather than a context map.</p>
<p>The supplied function is appended to the list of such functions. All the functions are invoked, but only invoked once (a subsequent interceptor also returning a channel does not have this side effect.</p>
<p>The callback function will be passed the context, but any returned value from the function is ignored.</p>
</div></div><div class="src-link"><a href="https://github.com/pedestal/pedestal/blob/0.7.0-beta-3/interceptor/src/io/pedestal/interceptor/chain.clj#L361">view source</a></div></div><div class="public anchor" id="var-queue"><h3>queue</h3><h4 class="added">added in 0.7.0</h4><div class="usage"><code>(queue context)</code></div><div class="doc"><div class="markdown"><p>Returns the contents of the queue, the as-yet uninvoked interceptors during the :enter phase of chain execution.</p>
<p>Prior to 0.7.0, this was achieved by accessing the :io.pedestal.interceptor.chain/queue key; future enhancements may change how the interceptor queue and stack are stored.</p>
</div></div><div class="src-link"><a href="https://github.com/pedestal/pedestal/blob/0.7.0-beta-3/interceptor/src/io/pedestal/interceptor/chain.clj#L469">view source</a></div></div><div class="public anchor" id="var-terminate"><h3>terminate</h3><div class="usage"><code>(terminate context)</code></div><div class="doc"><div class="markdown"><p>Removes all remaining interceptors from context’s execution queue. This effectively short-circuits execution of Interceptors’ :enter functions and begins executing the :leave functions.</p>
</div></div><div class="src-link"><a href="https://github.com/pedestal/pedestal/blob/0.7.0-beta-3/interceptor/src/io/pedestal/interceptor/chain.clj#L326">view source</a></div></div><div class="public anchor" id="var-terminate-when"><h3>terminate-when</h3><div class="usage"><code>(terminate-when context pred)</code></div><div class="doc"><div class="markdown"><p>Adds a predicate establishing a terminating condition for execution of the interceptor chain.</p>
<p>pred is a function that takes a context as its argument. It will be invoked after every Interceptor’s :enter function. If pred returns logical true, execution will stop at that Interceptor.</p>
</div></div><div class="src-link"><a href="https://github.com/pedestal/pedestal/blob/0.7.0-beta-3/interceptor/src/io/pedestal/interceptor/chain.clj#L334">view source</a></div></div><div class="public anchor" id="var-unbind"><h3>unbind</h3><h4 class="type">macro</h4><h4 class="added">added in 0.7.0</h4><div class="usage"><code>(unbind context var)</code></div><div class="doc"><div class="markdown"><p>Updates the context to remove a previous binding.</p>
</div></div><div class="src-link"><a href="https://github.com/pedestal/pedestal/blob/0.7.0-beta-3/interceptor/src/io/pedestal/interceptor/chain.clj#L383">view source</a></div></div></div></body></html>